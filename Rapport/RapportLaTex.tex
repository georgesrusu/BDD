\documentclass[12pt]{article}

\usepackage[latin1]{inputenc}
\usepackage[francais]{babel}
\usepackage{listings}
\usepackage{graphicx}
\usepackage{blindtext}
\usepackage{enumitem}
\title{Rapport : Projet  - Base de donnée}
\author{Maximilien ROMAIN (000411776) - George RUSU (000407965)}
\date{\today}

\begin{document}

\maketitle
\tableofcontents
\newpage

\section{Diagramme}
	\begin{flushleft}
		\includegraphics[scale=0.6]{BDD-UML-2Final.pdf}
	\end{flushleft}

\subsection{Contraintes :}

\begin{itemize}
	\item Un client peut etre un admin ou bien un utilisateur
	\item Un client ne peut pas commenter un même établissement une même date
	\item La date d'enregsitrement d'un utilisateur doit etre inferieure a la date de chaque commentaire
	\item Un client peut faire un commentaire sans choisir de label(tag)
	\item Un commentaire possede un ID unique et doit contenier l'ID du client, l'ID du label si il y en a un, l'ID de l'etablissement ainsi que le texte et le score.
	\item Un client ne peut pas labeliser plusieurs fois un même établissement avec un même label
\end{itemize}
\newpage

\section{Model Relationnel}
\begin{itemize}
	\item Etablissement(ID, Nom, Adresse, AdRue, AdNuméro, AdCodePostal, AdLocalité, Coordonnée, CoodLongitude, CoordLatitude, NumTelephone, \textit{SiteWeb})
	\item Restaurant(ID, FourchettePrix, NbrPlace, \textit{Emporter}, \textit{Livraison}, Fermeture)
	\\ID référence Etablissement.ID
	\item Bar(ID, \textit{Fumer}, \textit{Snack})
	\\ID référence Etablissement.ID
	\item Hotel(ID, NbrEtoiles, NbrChambres, IndicePrix)
	\\ID référence Etablissement.ID
	\item Client(ID, Identifiant, AdresseMail, MotDePasse, DateCréation)
	\item Utilisateur(ID)
	\\ID référence Client.ID
	\item Admin(ID)
	\\ID référence Client.ID
	\item Modification(AdminID, EtablissementID, TypeModif, Date)
	\\AdminID référence Client.ID; EtablissementID référence Etablissement.ID
	\item Commentaire(ID, Score, Texte, Date, EtablissementID, UtilisateurID)
	\\EtablissementID référence Etablissement.ID; UtilisateurID référence Client.ID
	\item Tag(ID, IDLabel, EtablissementID, UtilisateurID, IDListeTag) 
	\\EtablissementID référence Etablissement.ID; UtilisateurID référence Client.ID; IDLabel référence ListeTag.ID
	\item ListTag(ID, countUser, text)
	\item ClientCommentaire(ID, EtablissementID)
	\\ID référence Client.ID ; EtablissementID référence Commentaire.EtablissementID

\end{itemize}
\newpage

\section{Choix d'implémentation}
Pour expliquer notre schema UML plus haut, nous avons choisi l'implementation suivante: lorsqu'on voudra connaître les informations d'un établissement en particulière (commentaires, tags , auteur du commentaire, auteur du tag, etc) il nous suffira de retrouver son id correspondant et de regarder avec cet id dans les tables Commentaire et Tag. Idem, pour un utilisateur, si on souhaite savoir ce qu'il a commenté. Nous pouvons donc dire que nos deux tables de bases sont Commentaire et Tag. \\

En ce qui concerne l'ajout d'un label, nous avons decidé d'avoir une table ("ListeTag") qui va stocker tous les tag/label deja crée avec chacun leur id et chaque label qui caracterisera un etablissement dans la table Tag.\\

En ce qui concerne le disctinction entre utilisateur et admin, nous avons une colonne, isAdmin qui grace a un boolean ou bien a un int (0 ou 1) nous permet de savoir si le client est admin ou bien un simple utilisateur. L'héritage présent dans le schéma permet donc de voir ce qu'un admin peut faire en plus qu'un client standard. C'est même opération supplémentaire que peut faire un admin sont stocké dans une nouvelle table (Modification) qui va permettre de récupérer chaque modification d'un établissement, c'est à dire sont type de modification (Création, suppression ou modification) ainsi que sa date, l'admin qui a opéré et l'établissement concerné.\\

\section{Installation}
Afin d'installer l'application, il est d'abord nécéssaire de mettre en place la base de données qui contiendra toutes les informations qui seront utilisées par l'application.  Pour ce faire le premier fichier à éxécuter est Create-DB.php, en vérifiant que le fichier header\_connect.php se connectera bien au bon serveur.  Une fois fait la nouvelle base de donnée Eureka à été crée ainsi que toutes ses tables.  AFIN de ne pas commencer avec une application vide, nous allons parsons des informations se trouvant dans des fichiers XML.  Pour ce faire, nous éxécutons parser.php, qui comme l'indique son nom s'occupe de parser les fichiers XML et de remplir la base de donnée avec les données obtenues.  L'application est maintenant bien installé et il est possible désormais de l'utiliser correctement.

\section{Requetes}
\subsection{R1}
	$a \leftarrow \sigma_{identifiant="Brenda"}(Utilisateur)$

	$b \leftarrow \sigma_{clientID \ IN (a)\wedge score >= 4}(Commentaire)$

	$c \leftarrow \sigma_{etablissementID \ IN (b) \wedge \#Etablissement >= 3 }(Commentaire)$

	$d \leftarrow \sigma_{ID \ IN (c)}(Utilisateur)$

\subsection{R2}
	$a \leftarrow \pi (\sigma_{Identifiant="Brenda"}(Utilisateur))$

	$b \leftarrow a \ast Commentaire$

	$c \leftarrow \sigma_{score > 3}(b)$\\

	$d \leftarrow \sigma_{score > 3}(Commentaire)$

	$e \leftarrow \pi_{etablissementID, clientID}(d - c)$

	$f \leftarrow e \div c$

	$g \leftarrow \pi_{Nom}(f \bowtie_{etablissementID=ID} Etablissement)$

\subsection{R3}
	$a \leftarrow \pi_{ID}(Etablissement)$

	$b \leftarrow \sigma_{etablissemntID \ NOT \ IN \ (a) \ OR \ \# clientID \ <= \ 1}(Commentaire)$

\subsection{R4}
	$a \leftarrow \pi_{etablissementID, clientID}(ModificationAdmin)$

	$b \leftarrow \pi_{etablissementID}(Commentaire)$

	$c \leftarrow a \ast b$

	$d \leftarrow \pi_{etablissementID, clientID}(c)$

	$e \leftarrow a - d$

	$f \leftarrow \pi_{identitifant}(e \bowtie_{clientID=ID} Utilisateur)$

\section{Tuple relationnel}
\subsection{R1}
	$\{ u.Nom | Utilisateur(u) \wedge Commentaire(c) \wedge u.ID = c.clientID \wedge c.etablissementID >= 3 \wedge c.clientID = u.ID \wedge u.identifiant = "Brenda" \wedge c.score >= 4 \}$

\subsection{R2}
	$\{ e.Nom | Etablissement(e) \wedge \forall u \ Utilisateur(u) \rightarrow (\exists c (Commentaire(c) \wedge e.ID = c.etablissementID \wedge c.clientID = u.ID \wedge c.score > 3 \wedge u.Nom = "Brenda"))\}$

\subsection{R3}
	$\{ e.Nom | Etablissement(e) \wedge \exists \! \! \! / c_1 (Commentaire(c_1) \wedge c_1.etablissementID = e.ID) \vee \exists! c_2(Commentaire (c_2) \wedge c_2.etablissemendID = e.ID) \}$

\subsection{R4}
	$\{ u.Nom | Utilisateur(u) \wedge \exists e \exists \! \! \! / c (Etablissement(e) \wedge Commentaire(c) \wedge c.clientID = u.ID \wedge c.etablissementID = e.ID) \}$

\end{document}
























